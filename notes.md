# Learning notes

## JWT Pizza code study and debugging

## JWT Pizza Code Study and Debugging

As part of `Deliverable â“µ Development deployment: JWT Pizza`, I analyzed the application by debugging through the code. Below is my understanding of how different user activities map to frontend components, backend endpoints, and database operations.

### User Flow Mapping

| User activity                                       | Frontend component     | Backend endpoints                                   | Database SQL                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| --------------------------------------------------- | ---------------------- | --------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| View home page                                      | home.jsx               | None                                                | None                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Register new user<br/>(t@jwt.com, pw: test)         | register.jsx           | [POST] /api/auth                                    | `INSERT INTO user (name, email, password) VALUES (?, ?, ?)`<br/>`INSERT INTO userRole (userId, role, objectId) VALUES (?, ?, ?)`                                                                                                                                                                                                                                                                                                                                            |
| Login new user<br/>(t@jwt.com, pw: test)            | login.jsx              | [PUT] /api/auth                                     | `INSERT INTO auth (token, userId) VALUES (?, ?) ON DUPLICATE KEY UPDATE token=token`<br/>`SELECT * FROM user WHERE email=?`<br/>`SELECT * FROM userRole WHERE userId=?`                                                                                                                                                                                                                                                                                                     |
| Order pizza                                         | menu.jsx, payment.tsx  | [POST] /api/order                                   | `SELECT userId FROM auth WHERE token=?`<br/>`INSERT INTO dinerOrder (dinerId, franchiseId, storeId, date) VALUES (?, ?, ?, now())`<br/>`INSERT INTO orderItem (orderId, menuId, description, price) VALUES (?, ?, ?, ?)`                                                                                                                                                                                                                                                    |
| Verify pizza                                        | delivery.tsx           | None (in factory)                                   | None (in factory)                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| View profile page                                   | dinerDashboard.tsx     | [GET] api/user/me                                   | None                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| View franchise<br/>(as diner)                       | franchiseDashboard.tsx | [GET] /api/franchise/:userId                        | `SELECT id, name FROM store WHERE franchiseId=?`                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Logout                                              | logout.tsx             | [DELETE] /api/auth                                  | `DELETE FROM auth WHERE token=?`                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| View About page                                     | about.tsx              | None                                                | None                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| View History page                                   | history.tsx            | None                                                | None                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Login as franchisee<br/>(f@jwt.com, pw: franchisee) | login.jsx              | [PUT] /api/auth                                     | `INSERT INTO auth (token, userId) VALUES (?, ?) ON DUPLICATE KEY UPDATE token=token`<br/>`SELECT * FROM user WHERE email=?`<br/>`SELECT * FROM userRole WHERE userId=?`                                                                                                                                                                                                                                                                                                     |
| View franchise<br/>(as franchisee)                  | franchiseDashboard.tsx | [GET] /api/franchise/:userId                        | `SELECT objectId FROM userRole WHERE role='franchisee' AND userId=?`<br/>`SELECT id, name FROM franchise WHERE id in (franchiseIds)`<br/>`SELECT u.id, u.name, u.email FROM userRole ur JOIN user u ON u.id=ur.userId WHERE ur.objectId=? AND ur.role='franchisee'`<br/>`SELECT s.id, s.name, COALESCE(SUM(oi.price),0) AS totalRevenue FROM dinerOrder do JOIN orderItem oi ON do.id=oi.orderId RIGHT JOIN store s ON s.id=do.storeId WHERE s.franchiseId=? GROUP BY s.id` |
| Create a store                                      | createStore.tsx        | [POST] /api/franchise/:franchiseId/store            | `INSERT INTO store (franchiseId, name) VALUES (?, ?)`                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Close a store                                       | closeStore.tsx         | [DELETE] /api/franchise/:franchiseId/store/:storeId | `DELETE FROM store WHERE franchiseId=? AND id=?`                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Login as admin<br/>(a@jwt.com, pw: admin)           | login.jsx              | [PUT] /api/auth                                     | `INSERT INTO auth (token, userId) VALUES (?, ?) ON DUPLICATE KEY UPDATE token=token`<br/>`SELECT * FROM user WHERE email=?`<br/>`SELECT * FROM userRole WHERE userId=?`                                                                                                                                                                                                                                                                                                     |
| View Admin page                                     | adminDashboard.tsx     | [GET] /api/franchise?page=0&limit=10&name=\*        | `SELECT id, name FROM franchise WHERE name LIKE ? LIMIT ${limit + 1} OFFSET ${offset}`<br/>`SELECT id, name FROM store WHERE franchiseId=?`                                                                                                                                                                                                                                                                                                                                 |
| Create a franchise for t@jwt.com                    | createFranchise.tsx    | [POST] /api/franchise                               | `SELECT id, name FROM user WHERE email=?`<br/>`INSERT INTO franchise (name) VALUES (?)`<br/>`INSERT INTO userRole (userId, role, objectId) VALUES (?, ?, ?)`                                                                                                                                                                                                                                                                                                                |
| Close the franchise for t@jwt.com                   | closeFranchise.tsx     | [DELETE] /api/franchise/:franchiseId                | `DELETE FROM store WHERE franchiseId=?`<br/>`DELETE FROM userRole WHERE objectId=?`<br/>`DELETE FROM franchise WHERE id=?`                                                                                                                                                                                                                                                                                                                                                  |
